{"version":3,"sources":["test/polymer/polymer-element-scanner_test.ts"],"names":[],"mappings":"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","file":"polymer-element-scanner_test.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/// <reference path=\"../../../node_modules/@types/mocha/index.d.ts\" />\n\nimport {assert} from 'chai';\n\nimport {Visitor} from '../../javascript/estree-visitor';\nimport {JavaScriptParser} from '../../javascript/javascript-parser';\nimport {PolymerElementScanner} from '../../polymer/polymer-element-scanner';\nimport {CodeUnderliner} from '../test-utils';\n\nsuite('PolymerElementScanner', () => {\n\n  suite('scan()', () => {\n    let scanner: PolymerElementScanner;\n\n    setup(() => {\n      scanner = new PolymerElementScanner();\n    });\n\n    test('finds polymer elements', async() => {\n      const contents = `Polymer({\n        is: 'x-foo',\n        properties: {\n          a: {\n            type: Boolean,\n            value: 5\n          },\n          b: {\n            type: String,\n            value: function() {\n              return 'test';\n            }\n          },\n          c: {\n            type: Number,\n            readOnly: true\n          },\n          d: {\n            type: Number,\n            computed: '_computeD(c)'\n          },\n          e: {\n            type: String,\n            notify: true\n          },\n          f: {\n            type: Object,\n            observer: '_observeF'\n          },\n          g: {\n            type: {},\n            computed: '_computeG(a, b)',\n            readOnly: false\n          },\n          h: String,\n          all: {\n            type: Object,\n            notify: true,\n            readOnly: false,\n            reflectToAttribute: false,\n            observer: '_observeAll'\n          }\n        },\n        observers: [\n          '_anObserver(foo, bar)',\n          '_anotherObserver(foo)'\n        ],\n        listeners: {\n          'event-a': '_handleA',\n          eventb: '_handleB',\n          'event-c': _handleC,\n          [['event', 'd'].join('-')]: '_handleD'\n        },\n        customPublicMethod: (foo, bar) => { return foo + bar; },\n        _customPrivateMethod: (foo, bar) => { return foo + bar; },\n        /**\n         * This is an instance method with JS Doc\n         * @param {string} foo The first argument.\n         * @param {number} bar The second argument.\n         * @returns {boolean} The return.\n         */\n        customPublicMethodWithJsDoc: (foo, bar) => { return foo + bar; },\n        customPublicMethodWithClassicFunction: function(foo, bar) { return foo + bar; },\n      });\n      Polymer({\n        is: 'x-bar',\n        listeners: []\n      });`;\n\n      const document =\n          new JavaScriptParser().parse(contents, 'test-document.html');\n      const visit = async(visitor: Visitor) => document.visit([visitor]);\n\n      const {features} = await scanner.scan(document, visit);\n\n      assert.deepEqual(features.map((f) => f.tagName), ['x-foo', 'x-bar']);\n\n      assert.deepEqual(\n          features[0].observers.map((o) => o.expression),\n          ['_anObserver(foo, bar)', '_anotherObserver(foo)']);\n      assert.deepEqual(\n          features[0].observers.map(\n              (o) => o.parsedExpression!.properties.map((p) => p.name)),\n          [['_anObserver', 'foo', 'bar'], ['_anotherObserver', 'foo']]);\n      const properties = Array.from(features[0].properties.values());\n      assert.deepEqual(\n          properties.filter((p) => p.observerExpression)\n              .map(\n                  (p) =>\n                      [p.name,\n                       p.observerExpression!.properties.map((sp) => sp.name)]),\n          [['f', ['_observeF']], ['all', ['_observeAll']]]);\n\n      assert.deepEqual(\n          properties.filter((p) => p.computedExpression)\n              .map(\n                  (p) =>\n                      [p.name,\n                       p.computedExpression!.properties.map((sp) => sp.name)]),\n          [['d', ['_computeD', 'c']], ['g', ['_computeG', 'a', 'b']]]);\n\n      assert.deepEqual(\n          Array.from(features[0].events.values()).map((e) => e.name),\n          ['e-changed', 'all-changed']);\n\n      assert.equal(properties.length, 9);\n\n      assert.deepEqual(\n          properties.filter((p) => p.warnings.length > 0)\n              .map((p) => [p.name, p.warnings.map((w) => w.message)]),\n          [[\n            'g',\n            [\n              'Invalid type in property object.',\n              'Unable to determine type for property.'\n            ]\n          ]]);\n      const methods = Array.from(features[0].methods.values());\n      assert.deepEqual(methods.map((m) => m.name), [\n        'customPublicMethod',\n        '_customPrivateMethod',\n        'customPublicMethodWithJsDoc',\n        'customPublicMethodWithClassicFunction',\n      ]);\n\n      const jsDocMethod =\n          features[0].methods.get('customPublicMethodWithJsDoc')!;\n\n      assert.deepEqual(jsDocMethod.return !, {\n        type: 'boolean',\n        desc: 'The return.',\n      });\n\n      assert.deepEqual(\n          jsDocMethod.params!.map((p) => [p.name, p.type, p.description]), [\n            ['foo', 'string', 'The first argument.'],\n            ['bar', 'number', 'The second argument.'],\n          ]);\n\n      assert.deepEqual(properties.map((p) => [p.name, p.type]), [\n        ['a', 'boolean'],\n        ['b', 'string'],\n        ['c', 'number'],\n        ['d', 'number'],\n        ['e', 'string'],\n        ['f', 'Object'],\n        ['g', undefined],\n        ['h', 'string'],\n        ['all', 'Object']\n      ]);\n\n      assert.deepEqual(\n          Array.from(features[0].attributes.values())\n              .map((p) => [p.name, p.changeEvent]),\n          [\n            ['a', undefined],\n            ['b', undefined],\n            ['c', undefined],\n            ['d', undefined],\n            ['e', 'e-changed'],\n            ['f', undefined],\n            ['g', undefined],\n            ['h', undefined],\n            ['all', 'all-changed']\n          ]);\n\n      assert.deepEqual(\n          properties.filter((p) => p.readOnly).map((p) => p.name),\n          ['c', 'd', 'g']);\n\n      assert.deepEqual(\n          properties.filter((p) => p.default).map((p) => [p.name, p.default]),\n          [['a', '5'], ['b', '\"test\"']]);\n\n      assert.deepEqual(\n          properties.filter((p) => p.notify).map((p) => p.name), ['e', 'all']);\n\n      assert.deepEqual(features[0].listeners, [\n        {event: 'event-a', handler: '_handleA'},\n        {event: 'eventb', handler: '_handleB'}\n      ]);\n\n      // Skip not statically analizable entries without emitting a warning\n      assert.equal(\n          features[0]\n              .warnings\n              .filter((w) => w.code === 'invalid-listeners-declaration')\n              .length,\n          0);\n      // Emit warning for non-object `listeners` literal\n      assert.equal(\n          features[1]\n              .warnings\n              .filter((w) => w.code === 'invalid-listeners-declaration')\n              .length,\n          1);\n    });\n\n    test('finds declared and assigned call expressions', async() => {\n      const contents = `\n          const MyOtherElement = Polymer({\n            is: 'my-other-element'\n          });\n\n          window.MyElement = Polymer({is: 'my-element'});\n      `;\n      const document =\n          new JavaScriptParser().parse(contents, 'test-document.html');\n      const visit = async(visitor: Visitor) => document.visit([visitor]);\n\n      const {features} = await scanner.scan(document, visit);\n      assert.deepEqual(\n          features.map((f) => f.tagName), ['my-other-element', 'my-element']);\n      assert.deepEqual(\n          features.map((f) => f.className),\n          ['MyOtherElement', 'window.MyElement']);\n    });\n\n    const testName =\n        'Produces correct warnings for bad observers and computed properties';\n    test(testName, async() => {\n      const contents = `\n      Polymer({\n        is: 'x-foo',\n        properties: {\n          parseError: {\n            type: String,\n            computed: 'let let let',\n            observer: 'let let let',\n          },\n          badKindOfExpression: {\n            type: String,\n            computed: 'foo',\n            observer: 'foo(bar, baz)'\n          }\n        },\n        observers: [\n          'let let let parseError',\n          'foo'\n        ],\n        method() {\n          const shouldIgnore = {\n            ignore: 'please',\n            meToo: true\n          }\n        }\n      });`;\n\n      const underliner =\n          CodeUnderliner.withMapping('test-document.html', contents);\n      const document =\n          new JavaScriptParser().parse(contents, 'test-document.html');\n      const visit = async(visitor: Visitor) => document.visit([visitor]);\n\n      const {features} = await scanner.scan(document, visit);\n      assert.deepEqual(features.length, 1);\n      const element = features[0]!;\n      assert.deepEqual(\n          Array.from(element.properties.keys()),\n          ['parseError', 'badKindOfExpression']);\n\n      assert.deepEqual(\n          await Promise.all(Array.from(element.properties.values())\n                                .map((p) => underliner.underline(p.warnings))),\n          [\n            [\n              `\n            computed: 'let let let',\n                           ~`,\n              `\n            observer: 'let let let',\n                           ~`\n            ],\n            [\n              `\n            computed: 'foo',\n                       ~~~`,\n              `\n            observer: 'foo(bar, baz)'\n                       ~~~~~~~~~~~~~`\n            ]\n          ]);\n      assert.deepEqual(await underliner.underline(element.warnings), [\n        `\n          'let let let parseError',\n               ~`,\n        `\n          'foo'\n           ~~~`\n      ]);\n    });\n\n    test('Polymer 2 class observers crash', async() => {\n      // When Polymer 2 adopted a static getter for observers, it crashed\n      // the Polymer 1 element scanner.\n      const contents = `class TestElement extends Polymer.Element {\n        static get observers() {\n          return foo.bar;\n        }\n      }`;\n\n      const document =\n          new JavaScriptParser().parse(contents, 'test-document.html');\n      const visit = async(visitor: Visitor) => document.visit([visitor]);\n\n      // Scanning should not throw\n      await scanner.scan(document, visit);\n    });\n\n  });\n\n});\n"]}