<!--
@license
Copyright 2016 Google Inc. All Rights Reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file or at
https://github.com/firebase/polymerfire/blob/master/LICENSE
--><html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="firebase-common-behavior.html">
<link rel="import" href="firebase-auth-script.html">

<!--
`firebase-auth` is a wrapper around the Firebase authentication API. It notifies
successful authentication, provides user information, and handles different
types of authentication including anonymous, email / password, and several OAuth
workflows.

Example Usage:
```html
<firebase-app auth-domain="polymerfire-test.firebaseapp.com"
  database-url="https://polymerfire-test.firebaseio.com/"
  api-key="AIzaSyDTP-eiQezleFsV2WddFBAhF_WEzx_8v_g">
</firebase-app>
<firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError">
</firebase-auth>
```

The `firebase-app` element initializes `app` in `firebase-auth` (see
`firebase-app` documentation for more information), but an app name can simply
be specified at `firebase-auth`'s `app-name` property instead.

JavaScript sign-in calls can then be made to the `firebase-auth` object to
attempt authentication, e.g.:

```javascript
this.$.auth.signInWithPopup()
    .then(function(response) {// optionally handle a successful login})
    .catch(function(error) {// unsuccessful authentication response here});
```

This popup sign-in will then attempt to sign in using Google as an OAuth
provider since there was no provider argument specified and since `"google"` was
defined as the default provider.

The `user` property will automatically be populated if an active session is
available, so handling the resolved promise of sign-in methods is optional.

It's important to note that if you're using a Service Worker, and hosting on
Firebase, you should let urls that contain `/__/` go through to the network,
rather than have the Service Worker attempt to serve something from the cache.
The `__` namespace is reserved by Firebase and intercepting it will cause the
OAuth sign-in flow to break.

If you are self-deploying your app to some non-Firebase domain, this shouldn't
be a problem.
-->
</head><body><dom-module id="firebase-auth">
  <script>(function(){'use strict';Polymer({is:'firebase-auth',behaviors:[Polymer.FirebaseCommonBehavior],properties:{auth:{type:Object,computed:'_computeAuth(app)',observer:'__authChanged'},provider:{type:String,notify:!0},signedIn:{type:Boolean,computed:'_computeSignedIn(user)',notify:!0},user:{type:Object,readOnly:!0,value:null,notify:!0},statusKnown:{type:Boolean,value:!1,notify:!0,readOnly:!0,reflectToAttribute:!0}},signInAnonymously:function(){return this.auth?this._handleSignIn(this.auth.signInAnonymously()):Promise.reject('No app configured for firebase-auth!')},signInWithCustomToken:function(a){return this.auth?this._handleSignIn(this.auth.signInWithCustomToken(a)):Promise.reject('No app configured for firebase-auth!')},signInWithCredential:function(a){return this.auth?this._handleSignIn(this.auth.signInWithCredential(a)):Promise.reject('No app configured for firebase-auth!')},signInWithPopup:function(a){return this._attemptProviderSignIn(this._normalizeProvider(a),this.auth.signInWithPopup)},signInWithRedirect:function(a){return this._attemptProviderSignIn(this._normalizeProvider(a),this.auth.signInWithRedirect)},signInWithEmailAndPassword:function(a,b){return this._handleSignIn(this.auth.signInWithEmailAndPassword(a,b))},createUserWithEmailAndPassword:function(a,b){return this._handleSignIn(this.auth.createUserWithEmailAndPassword(a,b))},sendPasswordResetEmail:function(a){return this._handleSignIn(this.auth.sendPasswordResetEmail(a))},signOut:function(){return this.auth?this.auth.signOut():Promise.reject('No app configured for auth!')},_attemptProviderSignIn:function(a,b){return a=a||this._providerFromName(this.provider),a?this.auth?this._handleSignIn(b.call(this.auth,a)):Promise.reject('No app configured for firebase-auth!'):Promise.reject('Must supply a provider for popup sign in.')},_providerFromName:function(a){switch(a){case'facebook':return new firebase.auth.FacebookAuthProvider;case'github':return new firebase.auth.GithubAuthProvider;case'google':return new firebase.auth.GoogleAuthProvider;case'twitter':return new firebase.auth.TwitterAuthProvider;default:this.fire('error','Unrecognized firebase-auth provider "'+a+'"');}},_normalizeProvider:function(a){return'string'==typeof a?this._providerFromName(a):a},_handleSignIn:function(a){return a.catch(function(b){throw this.fire('error',b),b}.bind(this))},_computeSignedIn:function(a){return!!a},_computeAuth:function(){return this.app.auth()},__authChanged:function(a,b){this._setStatusKnown(!1),b!==a&&this._unsubscribe&&(this._unsubscribe(),this._unsubscribe=null),this.auth&&(this._unsubscribe=this.auth.onAuthStateChanged(function(c){this._setUser(c),this._setStatusKnown(!0)}.bind(this),function(c){this.fire('error',c)}.bind(this)))}})})();</script>
</dom-module>
</body></html>