{"version":3,"sources":["polymer/js-utils.ts"],"names":[],"mappings":"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","file":"js-utils.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as doctrine from 'doctrine';\nimport * as escodegen from 'escodegen';\nimport * as estree from 'estree';\n\nimport {closureType, getAttachedComment, objectKeyToString} from '../javascript/esutil';\nimport * as jsdoc from '../javascript/jsdoc';\nimport {Privacy, ScannedMethod, Severity, SourceRange, Warning} from '../model/model';\nimport {ParsedDocument} from '../parser/document';\n\nimport {ScannedPolymerProperty} from './polymer-element';\n\n/**\n * Create a ScannedProperty object from an estree Property AST node.\n */\nexport function toScannedPolymerProperty(\n    node: estree.Property|estree.MethodDefinition,\n    sourceRange: SourceRange,\n    document: ParsedDocument<any, any>): ScannedPolymerProperty {\n  const parsedJsdoc = jsdoc.parseJsdoc(getAttachedComment(node) || '');\n  const description = parsedJsdoc.description.trim();\n  const maybeName = objectKeyToString(node.key);\n\n  const warnings: Warning[] = [];\n  if (!maybeName) {\n    warnings.push(new Warning({\n      code: 'unknown-prop-name',\n      message:\n          `Could not determine name of property from expression of type: ` +\n          `${node.key.type}`,\n      sourceRange: sourceRange,\n      severity: Severity.WARNING,\n      parsedDocument: document\n    }));\n  }\n  let type = closureType(node.value, sourceRange, document);\n  const typeTag = jsdoc.getTag(parsedJsdoc, 'type');\n  if (typeTag) {\n    type = doctrine.type.stringify(typeTag.type!) || type;\n  }\n  const name = maybeName || '';\n  const result: ScannedPolymerProperty = {\n    name,\n    type,\n    description,\n    sourceRange,\n    warnings,\n    astNode: node,\n    isConfiguration: configurationProperties.has(name),\n    jsdoc: parsedJsdoc,\n    privacy: getOrInferPrivacy(name, parsedJsdoc)\n  };\n\n  return result;\n};\n\n/**\n * Properties on Polymer element prototypes that are part of Polymer's\n * configuration syntax.\n */\nconst configurationProperties = new Set([\n  'attached',\n  'attributeChanged',\n  'beforeRegister',\n  'configure',\n  'constructor',\n  'created',\n  'detached',\n  'enableCustomStyleProperties',\n  'extends',\n  'hostAttributes',\n  'is',\n  'listeners',\n  'mixins',\n  'observers',\n  'properties',\n  'ready',\n  'registered',\n]);\n\n/**\n * Create a ScannedMethod object from an estree Property AST node.\n */\nexport function toScannedMethod(\n    node: estree.Property|estree.MethodDefinition,\n    sourceRange: SourceRange,\n    document: ParsedDocument<any, any>): ScannedMethod {\n  const scannedMethod: ScannedMethod =\n      toScannedPolymerProperty(node, sourceRange, document);\n\n  if (scannedMethod.type === 'Function' ||\n      scannedMethod.type === 'ArrowFunction') {\n    const value = <estree.FunctionExpression>node.value;\n\n    const paramTags = new Map<string, doctrine.Tag>();\n    if (scannedMethod.jsdoc) {\n      for (const tag of (scannedMethod.jsdoc.tags || [])) {\n        if (tag.title === 'param' && tag.name) {\n          paramTags.set(tag.name, tag);\n\n        } else if (tag.title === 'return' || tag.title === 'returns') {\n          scannedMethod.return = {};\n          if (tag.type) {\n            scannedMethod.return.type = doctrine.type.stringify(tag.type!);\n          }\n          if (tag.description) {\n            scannedMethod.return.desc = tag.description;\n          }\n        }\n      }\n    }\n\n    scannedMethod.params = (value.params || []).map((nodeParam) => {\n      let type = undefined;\n      let description = undefined;\n      // With ES6 we can have a lot of param patterns. Best to leave the\n      // formatting to escodegen.\n      const name = escodegen.generate(nodeParam);\n      const tag = paramTags.get(name);\n      if (tag) {\n        if (tag.type) {\n          type = doctrine.type.stringify(tag.type);\n        }\n        if (tag.description) {\n          description = tag.description;\n        }\n      }\n      return {name, type, description};\n    });\n  }\n\n  return scannedMethod;\n}\n\n\nexport function getOrInferPrivacy(\n    name: string,\n    annotation: jsdoc.Annotation|undefined,\n    defaultPrivacy: Privacy = 'public'): Privacy {\n  const explicitPrivacy = jsdoc.getPrivacy(annotation);\n  const specificName = name.slice(name.lastIndexOf('.') + 1);\n\n  if (explicitPrivacy) {\n    return explicitPrivacy;\n  }\n  if (specificName.startsWith('__')) {\n    return 'private';\n  } else if (specificName.startsWith('_')) {\n    return 'protected';\n  } else if (specificName.endsWith('_')) {\n    return 'private';\n  } else if (configurationProperties.has(specificName)) {\n    return 'protected';\n  }\n  return defaultPrivacy;\n}\n"]}