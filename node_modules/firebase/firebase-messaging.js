/*! @license Firebase v4.1.3
Build: rev-1234895
Terms: https://firebase.google.com/terms/ */

try{webpackJsonpFirebase([1],[,,,,,function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0});var o,i={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key"},a=(o={},n(o,i.AVAILABLE_IN_WINDOW,"This method is available in a Window context."),n(o,i.AVAILABLE_IN_SW,"This method is available in a service worker context."),n(o,i.SHOULD_BE_INHERITED,"This method should be overriden by extended classes."),n(o,i.BAD_SENDER_ID,"Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp()."),n(o,i.PERMISSION_DEFAULT,"The required permissions were not granted and dismissed instead."),n(o,i.PERMISSION_BLOCKED,"The required permissions were not granted and blocked instead."),n(o,i.UNSUPPORTED_BROWSER,"This browser doesn't support the API's required to use the firebase SDK."),n(o,i.NOTIFICATIONS_BLOCKED,"Notifications have been blocked."),n(o,i.FAILED_DEFAULT_REGISTRATION,"We are unable to register the default service worker. {$browserErrorMessage}"),n(o,i.SW_REGISTRATION_EXPECTED,"A service worker registration was the expected input."),n(o,i.GET_SUBSCRIPTION_FAILED,"There was an error when trying to get any existing Push Subscriptions."),n(o,i.INVALID_SAVED_TOKEN,"Unable to access details of the saved token."),n(o,i.SW_REG_REDUNDANT,"The service worker being used for push was made redundant."),n(o,i.TOKEN_SUBSCRIBE_FAILED,"A problem occured while subscribing the user to FCM: {$message}"),n(o,i.TOKEN_SUBSCRIBE_NO_TOKEN,"FCM returned no token when subscribing the user to push."),n(o,i.TOKEN_SUBSCRIBE_NO_PUSH_SET,"FCM returned an invalid response when getting an FCM token."),n(o,i.USE_SW_BEFORE_GET_TOKEN,"You must call useServiceWorker() before calling getToken() to ensure your service worker is used."),n(o,i.INVALID_DELETE_TOKEN,"You must pass a valid token into deleteToken(), i.e. the token from getToken()."),n(o,i.DELETE_TOKEN_NOT_FOUND,"The deletion attempt for token could not be performed as the token was not found."),n(o,i.DELETE_SCOPE_NOT_FOUND,"The deletion attempt for service worker scope could not be performed as the scope was not found."),n(o,i.BG_HANDLER_FUNCTION_EXPECTED,"The input to setBackgroundMessageHandler() must be a function."),n(o,i.NO_WINDOW_CLIENT_TO_MSG,"An attempt was made to message a non-existant window client."),n(o,i.UNABLE_TO_RESUBSCRIBE,"There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}"),n(o,i.NO_FCM_TOKEN_FOR_RESUBSCRIBE,"Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit."),n(o,i.FAILED_TO_DELETE_TOKEN,"Unable to delete the currently saved token."),n(o,i.NO_SW_IN_REG,"Even though the service worker registration was successful, there was a problem accessing the service worker itself."),n(o,i.INCORRECT_GCM_SENDER_ID,"Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging."),n(o,i.BAD_SCOPE,"The service worker scope must be a string with at least one character."),n(o,i.BAD_VAPID_KEY,"The public VAPID key must be a string with at least one character."),n(o,i.BAD_SUBSCRIPTION,"The subscription must be a valid PushSubscription."),n(o,i.BAD_TOKEN,"The FCM Token used for storage / lookup was not a valid token string."),n(o,i.BAD_PUSH_SET,"The FCM push set used for storage / lookup was not not a valid push set string."),n(o,i.FAILED_DELETE_VAPID_KEY,"The VAPID key could not be deleted."),o);t.default={codes:i,map:a},e.exports=t.default},,,,,,,,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(9),s=r(5),u=n(s),c=r(36),f=n(c),l=r(20),_=n(l),d="messagingSenderId",h=function(){function e(t){var r=this;if(o(this,e),this.errorFactory_=new a.ErrorFactory("messaging","Messaging",u.default.map),!t.options[d]||"string"!=typeof t.options[d])throw this.errorFactory_.create(u.default.codes.BAD_SENDER_ID);this.messagingSenderId_=t.options[d],this.tokenManager_=new f.default,this.app=t,this.INTERNAL={},this.INTERNAL.delete=function(){return r.delete}}return i(e,[{key:"getToken",value:function(){var e=this,t=this.getNotificationPermission_();return t!==_.default.granted?t===_.default.denied?Promise.reject(this.errorFactory_.create(u.default.codes.NOTIFICATIONS_BLOCKED)):Promise.resolve(null):this.getSWRegistration_().then(function(t){return e.tokenManager_.getSavedToken(e.messagingSenderId_,t).then(function(r){return r||e.tokenManager_.createToken(e.messagingSenderId_,t)})})}},{key:"deleteToken",value:function(e){var t=this;return this.tokenManager_.deleteToken(e).then(function(){return t.getSWRegistration_().then(function(e){if(e)return e.pushManager.getSubscription()}).then(function(e){if(e)return e.unsubscribe()})})}},{key:"getSWRegistration_",value:function(){throw this.errorFactory_.create(u.default.codes.SHOULD_BE_INHERITED)}},{key:"requestPermission",value:function(){throw this.errorFactory_.create(u.default.codes.AVAILABLE_IN_WINDOW)}},{key:"useServiceWorker",value:function(){throw this.errorFactory_.create(u.default.codes.AVAILABLE_IN_WINDOW)}},{key:"onMessage",value:function(){throw this.errorFactory_.create(u.default.codes.AVAILABLE_IN_WINDOW)}},{key:"onTokenRefresh",value:function(){throw this.errorFactory_.create(u.default.codes.AVAILABLE_IN_WINDOW)}},{key:"setBackgroundMessageHandler",value:function(){throw this.errorFactory_.create(u.default.codes.AVAILABLE_IN_SW)}},{key:"delete",value:function(){this.tokenManager_.closeDatabase()}},{key:"getNotificationPermission_",value:function(){return Notification.permission}},{key:"getTokenManager",value:function(){return this.tokenManager_}}]),e}();t.default=h,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=[4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110],o={userVisibleOnly:!0,applicationServerKey:new Uint8Array(n)};t.default={ENDPOINT:"https://fcm.googleapis.com",APPLICATION_SERVER_KEY:n,SUBSCRIPTION_OPTIONS:o},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={granted:"granted",default:"default",denied:"denied"},e.exports=t.default},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0});var o={TYPE_OF_MSG:"firebase-messaging-msg-type",DATA:"firebase-messaging-msg-data"},i={PUSH_MSG_RECEIVED:"push-msg-received",NOTIFICATION_CLICKED:"notification-clicked"},a=function(e,t){var r;return r={},n(r,o.TYPE_OF_MSG,e),n(r,o.DATA,t),r};t.default={PARAMS:o,TYPES_OF_MSG:i,createNewMsg:a},e.exports=t.default},,,,,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(18),l=n(f),_=r(5),d=n(_),h=r(21),E=n(h),p=r(19),g=n(p),T=function(e){function t(e){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return self.addEventListener("push",function(e){return r.onPush_(e)},!1),self.addEventListener("pushsubscriptionchange",function(e){return r.onSubChange_(e)},!1),self.addEventListener("notificationclick",function(e){return r.onNotificationClick_(e)},!1),r.bgMessageHandler_=null,r}return s(t,e),c(t,[{key:"onPush_",value:function(e){var t=this,r=void 0;try{r=e.data.json()}catch(e){return}var n=this.hasVisibleClients_().then(function(e){if(e){if(r.notification||t.bgMessageHandler_)return t.sendMessageToWindowClients_(r)}else{var n=t.getNotificationData_(r);if(n){var o=n.title||"";return self.registration.showNotification(o,n)}if(t.bgMessageHandler_)return t.bgMessageHandler_(r)}});e.waitUntil(n)}},{key:"onSubChange_",value:function(e){var t=this,r=this.getToken().then(function(e){if(!e)throw t.errorFactory_.create(d.default.codes.NO_FCM_TOKEN_FOR_RESUBSCRIBE);var r=null,n=t.getTokenManager();return n.getTokenDetailsFromToken(e).then(function(e){if(!(r=e))throw t.errorFactory_.create(d.default.codes.INVALID_SAVED_TOKEN);return self.registration.pushManager.subscribe(g.default.SUBSCRIPTION_OPTIONS)}).then(function(e){return n.subscribeToFCM(r.fcmSenderId,e,r.fcmPushSet)}).catch(function(e){return n.deleteToken(r.fcmToken).then(function(){throw t.errorFactory_.create(d.default.codes.UNABLE_TO_RESUBSCRIBE,{message:e})})})});e.waitUntil(r)}},{key:"onNotificationClick_",value:function(e){var t=this;if(e.notification&&e.notification.data&&e.notification.data.FCM_MSG){e.stopImmediatePropagation(),e.notification.close();var r=e.notification.data.FCM_MSG,n=r.notification.click_action;if(n){var o=this.getWindowClient_(n).then(function(e){return e||self.clients.openWindow(n)}).then(function(e){if(e){r.notification,delete r.notification;var n=E.default.createNewMsg(E.default.TYPES_OF_MSG.NOTIFICATION_CLICKED,r);return t.attemptToMessageClient_(e,n)}});e.waitUntil(o)}}}},{key:"getNotificationData_",value:function(e){if(e&&"object"===u(e.notification)){var t=Object.assign({},e.notification);return t.data=o({},"FCM_MSG",e),t}}},{key:"setBackgroundMessageHandler",value:function(e){if(e&&"function"!=typeof e)throw this.errorFactory_.create(d.default.codes.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler_=e}},{key:"getWindowClient_",value:function(e){var t=new URL(e).href;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){for(var r=null,n=0;n<e.length;n++){if(new URL(e[n].url).href===t){r=e[n];break}}if(r)return r.focus(),r})}},{key:"attemptToMessageClient_",value:function(e,t){var r=this;return new Promise(function(n,o){if(!e)return o(r.errorFactory_.create(d.default.codes.NO_WINDOW_CLIENT_TO_MSG));e.postMessage(t),n()})}},{key:"hasVisibleClients_",value:function(){return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){return e.some(function(e){return"visible"===e.visibilityState})})}},{key:"sendMessageToWindowClients_",value:function(e){var t=this;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(r){var n=E.default.createNewMsg(E.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED,e);return Promise.all(r.map(function(e){return t.attemptToMessageClient_(e,n)}))})}},{key:"getSWRegistration_",value:function(){return Promise.resolve(self.registration)}}]),t}(l.default);t.default=T,e.exports=t.default},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},c=r(18),f=n(c),l=r(5),_=n(l),d=r(21),h=n(d),E=r(35),p=n(E),g=r(20),T=n(g),S=r(17),v=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.registrationToUse_,r.manifestCheckPromise_,r.messageObserver_=null,r.onMessage_=(0,S.createSubscribe)(function(e){r.messageObserver_=e}),r.tokenRefreshObserver_=null,r.onTokenRefresh_=(0,S.createSubscribe)(function(e){r.tokenRefreshObserver_=e}),r.setupSWMessageListener_(),r}return a(t,e),s(t,[{key:"getToken",value:function(){var e=this;return this.isSupported_()?this.manifestCheck_().then(function(){return u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getToken",e).call(e)}):Promise.reject(this.errorFactory_.create(_.default.codes.UNSUPPORTED_BROWSER))}},{key:"manifestCheck_",value:function(){var e=this;if(this.manifestCheckPromise_)return this.manifestCheckPromise_;var t=document.querySelector('link[rel="manifest"]');return this.manifestCheckPromise_=t?fetch(t.href).then(function(e){return e.json()}).catch(function(){return Promise.resolve()}).then(function(t){if(t&&t.gcm_sender_id&&"103953800507"!==t.gcm_sender_id)throw e.errorFactory_.create(_.default.codes.INCORRECT_GCM_SENDER_ID)}):Promise.resolve(),this.manifestCheckPromise_}},{key:"requestPermission",value:function(){var e=this;return Notification.permission===T.default.granted?Promise.resolve():new Promise(function(t,r){var n=function(n){return n===T.default.granted?t():r(n===T.default.denied?e.errorFactory_.create(_.default.codes.PERMISSION_BLOCKED):e.errorFactory_.create(_.default.codes.PERMISSION_DEFAULT))},o=Notification.requestPermission(function(e){o||n(e)});o&&o.then(n)})}},{key:"useServiceWorker",value:function(e){if(!(e instanceof ServiceWorkerRegistration))throw this.errorFactory_.create(_.default.codes.SW_REGISTRATION_EXPECTED);if(void 0!==this.registrationToUse_)throw this.errorFactory_.create(_.default.codes.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse_=e}},{key:"onMessage",value:function(e,t,r){return this.onMessage_(e,t,r)}},{key:"onTokenRefresh",value:function(e,t,r){return this.onTokenRefresh_(e,t,r)}},{key:"waitForRegistrationToActivate_",value:function(e){var t=this,r=e.installing||e.waiting||e.active;return new Promise(function(n,o){if(!r)return void o(t.errorFactory_.create(_.default.codes.NO_SW_IN_REG));if("activated"===r.state)return void n(e);if("redundant"===r.state)return void o(t.errorFactory_.create(_.default.codes.SW_REG_REDUNDANT));var i=function(){if("activated"===r.state)n(e);else{if("redundant"!==r.state)return;o(t.errorFactory_.create(_.default.codes.SW_REG_REDUNDANT))}r.removeEventListener("statechange",i)};r.addEventListener("statechange",i)})}},{key:"getSWRegistration_",value:function(){var e=this;return this.registrationToUse_?this.waitForRegistrationToActivate_(this.registrationToUse_):(this.registrationToUse_=null,navigator.serviceWorker.register(p.default.path,{scope:p.default.scope}).catch(function(t){throw e.errorFactory_.create(_.default.codes.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return e.registrationToUse_=t,t.update(),t})}))}},{key:"setupSWMessageListener_",value:function(){var e=this;"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[h.default.PARAMS.TYPE_OF_MSG]){var r=t.data;switch(r[h.default.PARAMS.TYPE_OF_MSG]){case h.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED:case h.default.TYPES_OF_MSG.NOTIFICATION_CLICKED:var n=r[h.default.PARAMS.DATA];e.messageObserver_.next(n)}}},!1)}},{key:"isSupported_",value:function(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}}]),t}(f.default);t.default=v,e.exports=t.default},,,,function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){e.INTERNAL.registerService("messaging",function(e){return self&&"ServiceWorkerGlobalScope"in self?new u.default(e):new a.default(e)},{Messaging:a.default})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerMessaging=o;var i=r(29),a=n(i),s=r(28),u=n(s);o(n(r(4)).default)},function(e,t,r){"use strict";function n(e){var t=new Uint8Array(e);return window.btoa(String.fromCharCode.apply(null,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={path:"/firebase-messaging-sw.js",scope:"/firebase-cloud-messaging-push-scope"},e.exports=t.default},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(9),s=r(5),u=n(s),c=r(34),f=n(c),l=r(19),_=n(l),d="fcm_token_object_Store",h=function(){function e(){o(this,e),this.errorFactory_=new a.ErrorFactory("messaging","Messaging",u.default.map),this.openDbPromise_=null}return i(e,[{key:"openDatabase_",value:function(){return this.openDbPromise_?this.openDbPromise_:(this.openDbPromise_=new Promise(function(e,t){var r=indexedDB.open("fcm_token_details_db",1);r.onerror=function(e){t(e.target.error)},r.onsuccess=function(t){e(t.target.result)},r.onupgradeneeded=function(e){var t=e.target.result,r=t.createObjectStore(d,{keyPath:"swScope"});r.createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0})}}),this.openDbPromise_)}},{key:"closeDatabase",value:function(){var e=this;return this.openDbPromise_?this.openDbPromise_.then(function(t){t.close(),e.openDbPromise_=null}):Promise.resolve()}},{key:"getTokenDetailsFromToken",value:function(e){return this.openDatabase_().then(function(t){return new Promise(function(r,n){var o=t.transaction([d]),i=o.objectStore(d),a=i.index("fcmToken"),s=a.get(e);s.onerror=function(e){n(e.target.error)},s.onsuccess=function(e){r(e.target.result)}})})}},{key:"getTokenDetailsFromSWScope_",value:function(e){return this.openDatabase_().then(function(t){return new Promise(function(r,n){var o=t.transaction([d]),i=o.objectStore(d),a=i.get(e);a.onerror=function(e){n(e.target.error)},a.onsuccess=function(e){r(e.target.result)}})})}},{key:"getAllTokenDetailsForSenderId_",value:function(e){return this.openDatabase_().then(function(t){return new Promise(function(r,n){var o=t.transaction([d]),i=o.objectStore(d),a=[],s=i.openCursor();s.onerror=function(e){n(e.target.error)},s.onsuccess=function(t){var n=t.target.result;n?(n.value.fcmSenderId===e&&a.push(n.value),n.continue()):r(a)}})})}},{key:"subscribeToFCM",value:function(e,t,r){var n=this,o=(0,f.default)(t.getKey("p256dh")),i=(0,f.default)(t.getKey("auth")),a="authorized_entity="+e+"&endpoint="+t.endpoint+"&encryption_key="+o+"&encryption_auth="+i;r&&(a+="&pushSet="+r);var s=new Headers;s.append("Content-Type","application/x-www-form-urlencoded");var c={method:"POST",headers:s,body:a};return fetch(_.default.ENDPOINT+"/fcm/connect/subscribe",c).then(function(e){return e.json()}).then(function(e){var t=e;if(t.error){var r=t.error.message;throw n.errorFactory_.create(u.default.codes.TOKEN_SUBSCRIBE_FAILED,{message:r})}if(!t.token)throw n.errorFactory_.create(u.default.codes.TOKEN_SUBSCRIBE_NO_TOKEN);if(!t.pushSet)throw n.errorFactory_.create(u.default.codes.TOKEN_SUBSCRIBE_NO_PUSH_SET);return{token:t.token,pushSet:t.pushSet}})}},{key:"isSameSubscription_",value:function(e,t){return e.endpoint===t.endpoint&&(0,f.default)(e.getKey("auth"))===t.auth&&(0,f.default)(e.getKey("p256dh"))===t.p256dh}},{key:"saveTokenDetails_",value:function(e,t,r,n,o){var i={swScope:t.scope,endpoint:r.endpoint,auth:(0,f.default)(r.getKey("auth")),p256dh:(0,f.default)(r.getKey("p256dh")),fcmToken:n,fcmPushSet:o,fcmSenderId:e};return this.openDatabase_().then(function(e){return new Promise(function(t,r){var n=e.transaction([d],"readwrite"),o=n.objectStore(d),a=o.put(i);a.onerror=function(e){r(e.target.error)},a.onsuccess=function(){t()}})})}},{key:"getSavedToken",value:function(e,t){var r=this;return t instanceof ServiceWorkerRegistration?"string"!=typeof e||0===e.length?Promise.reject(this.errorFactory_.create(u.default.codes.BAD_SENDER_ID)):this.getAllTokenDetailsForSenderId_(e).then(function(r){if(0!==r.length){var n=r.findIndex(function(r){return t.scope===r.swScope&&e===r.fcmSenderId});if(-1!==n)return r[n]}}).then(function(e){if(e)return t.pushManager.getSubscription().catch(function(){throw r.errorFactory_.create(u.default.codes.GET_SUBSCRIPTION_FAILED)}).then(function(t){if(t&&r.isSameSubscription_(t,e))return e.fcmToken})}):Promise.reject(this.errorFactory_.create(u.default.codes.SW_REGISTRATION_EXPECTED))}},{key:"createToken",value:function(e,t){var r=this;if("string"!=typeof e||0===e.length)return Promise.reject(this.errorFactory_.create(u.default.codes.BAD_SENDER_ID));if(!(t instanceof ServiceWorkerRegistration))return Promise.reject(this.errorFactory_.create(u.default.codes.SW_REGISTRATION_EXPECTED));var n=void 0,o=void 0;return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe(_.default.SUBSCRIPTION_OPTIONS)}).then(function(t){return n=t,r.subscribeToFCM(e,n)}).then(function(i){return o=i,r.saveTokenDetails_(e,t,n,o.token,o.pushSet)}).then(function(){return o.token})}},{key:"deleteToken",value:function(e){var t=this;return"string"!=typeof e||0===e.length?Promise.reject(this.errorFactory_.create(u.default.codes.INVALID_DELETE_TOKEN)):this.getTokenDetailsFromToken(e).then(function(e){if(!e)throw t.errorFactory_.create(u.default.codes.DELETE_TOKEN_NOT_FOUND);return t.openDatabase_().then(function(r){return new Promise(function(n,o){var i=r.transaction([d],"readwrite"),a=i.objectStore(d),s=a.delete(e.swScope);s.onerror=function(e){o(e.target.error)},s.onsuccess=function(r){if(0===r.target.result)return void o(t.errorFactory_.create(u.default.codes.FAILED_TO_DELETE_TOKEN));n(e)}})})})}}]),e}();t.default=h,e.exports=t.default}],[33])}catch(e){throw new Error("Cannot instantiate firebase-messaging.js - be sure to load firebase-app.js first.")}
//# sourceMappingURL=firebase-messaging.js.map